!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){e.wwmanager={pool:[],wk_pool:[],pmax:navigator.hardwareConcurrency||10,queue:[]},e.extend(e.fn,{wwmanager:function(){var a=arguments[0],n=[].slice.call(arguments).slice(1);if(r[a])return r[a].apply(this,n);if(a){var o=t.checkAPI(e.wwmanager,a,r);e.wwmanager=o.local,r=o.API}t.startup(a,n[0],n[1])}});var r={debug:function(){console.log(e.wwmanager)},spin_up:function(e,r,a){t.spin_up(e,r,a)}},t={startup:function(e,r,a){t.spin_up(e,r,a)},id_counter:0,newID:function(){var e=new Date;return e=e.getTime()+Math.floor(2e3*Math.random()),t.id_counter++,""+(e+t.id_counter)},checkAPI:function(r,t,a){var n={};for(var o in r)if(n[o]=r[o],t.hasOwnProperty(o))if("object"==typeof n[o])if(Array.isArray(n[o])&&Array.isArray(t[o])){n[o]=[];for(var u=t[o],c=n[o],s=0;s<t[o].length;s++){var i=u[s];c.push(i)}}else"string"==typeof t[o]&&Array.isArray(n[o])?n[o].push(t[o]):n[o]=t[o];else n[o]=t[o];return e.each(a,function(e,r){null!=t[e]&&(a[e]=t[e])}),{local:n,API:a}},terminate:{_root:function(){return t},chk:function(){for(var r=this._root(),t=e.wwmanager,a=t.pool.length,n=t.queue.length,o=0;o<a;o++){for(var u=t.pool[o],c=0,s=0;s<n;s++){var i=t.queue[s];try{if(null!=u&&u.w_type==i.wk_type){c=1;break}}catch(e){console.log("[terminate.chk] error checking workers vs queue ",e,u,i)}}if(null!=u&&u.available&&0==u.persist&&0==c&&(t.pool.splice(o,1),u.terminate(),u=null),c>0){r.chk_queue();break}}if(0==t.queue.length&&0==t.pool.length){var l=this.watch;clearInterval(l),l=!1}},watch:!1,start:function(){0==this.watch&&(this.watch=setInterval(function(){t.terminate.chk()},50))}},get_cmd:function(e){return!("object"!=typeof e||!e.hasOwnProperty("cmd"))&&e.cmd},proc_fn:function(r){try{for(var a=e.wwmanager,n=r.currentTarget,o=a.queue.length,u=0;u<o;u++){var c=a.queue[u];if(c.uid==n.uid){var s=r.data,i=!0;(i="wait"!=t.get_cmd(s))||s.hasOwnProperty("data")&&(s=s.data),n.success?c.fn.success(s,r):c.fn.failure(s,r),i&&a.queue.splice(u,1);break}}}catch(e){console.log("[wwmanager.methods.proc_fn] error ",e),console.log("[wwmanager.methods.proc_fn] last attempted to process ",r)}},spin_up:function(r,a,n){var o=e.wwmanager;if(n){n.active=!1,n.wk_type=a;var u=function(e,r){0==r.currentTarget.nomsg&&console.log("[wwmanager.success] resp",e)},c=function(e,r){0==r.currentTarget.nomsg&&console.log("[wwmanager.failure] resp",e)};n.hasOwnProperty("fn")?(n.fn.success||(n.fn.success=u),n.fn.failure||(n.fn.failure=c)):n.fn={success:u,failure:c},n.uid=t.newID(),o.queue.push(n)}r&&o.wk_pool.push({fnc:r,type:a}),t.chk_make_thread(),t.chk_queue(),t.terminate.start()},chk_make_thread:function(){var r=e.wwmanager,a=function(e){var r=e.currentTarget.w_key;"message"==e.type&&(e.currentTarget.success=!0),"error"==e.type&&(e.currentTarget.success=!1,console.log("[wwmanager.methods.worker "+r+"] error ... ",e.message),console.log("[wwmanager.methods.worker "+r+"] details ... ",e));var a="wait"!=t.get_cmd(e.data);t.proc_fn(e),a&&(e.currentTarget.available=!0,t.spin_up())};if(r.pool.length<r.pmax)for(var n=r.pool.length-1<0?0:r.pool.length-1;n<r.pmax;n++)if(r.wk_pool.length>0){var o=r.wk_pool[r.wk_pool.length-1],u=t.create_worker(o.fnc);r.wk_pool.pop(),u.w_key=n,u.w_type=o.type,u.available=!0,u.onmessage=a,u.onerror=a,r.pool.push(u)}},chk_queue:function(){for(var r=e.wwmanager,a=!1,n=r.queue.length,o=0;o<n;o++){0==(c=r.queue[o]).active&&(a=!0)}if(a){var u=!0;for(o=0;o<n;o++){var c;if(0==(c=r.queue[o]).active){var s={};for(var i in c)"function"!=typeof c[i]&&"fn"!=i&&(s[i]=c[i]);for(var l=0;l<r.pmax;l++){var p=r.pool[l];if(p.available&&p.w_type==c.wk_type){p.persist=!1,s.hasOwnProperty("persist")&&(p.persist=s.persist),p.nomsg=!1,s.hasOwnProperty("nomsg")&&(p.nomsg=s.nomsg),p.postMessage(s),p.uid=s.uid,p.available=!1,c.active=!0,u=!1;break}}}}u&&setTimeout(function(){t.spin_up()},10)}},create_worker:function(e){var r=new Blob(["onmessage = (",e.toString(),")"],{type:"text/worker"}),t=URL.createObjectURL(r);return new Worker(t)}}});