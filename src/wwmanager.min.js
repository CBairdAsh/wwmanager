!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(l){l.wwmanager={pool:[],wk_pool:[],pmax:navigator.hardwareConcurrency||10,queue:[]},l.extend(l.fn,{wwmanager:function(){var e=arguments[0],r=[].slice.call(arguments).slice(1);if(n[e])return n[e].apply(this,r);if(e){var t=f.checkAPI(l.wwmanager,e,n);l.wwmanager=t.local,n=t.API}f.startup(e,r[0],r[1])}});var n={debug:function(){console.log(l.wwmanager)},spin_up:function(e,r,t){f.spin_up(e,r,t)}},f={cmds:["wait","stop"],startup:function(e,r,t){f.spin_up(e,r,t)},id_counter:0,newID:function(){var e=new Date;return e=e.getTime()+Math.floor(2e3*Math.random()),f.id_counter++,""+(e+f.id_counter)},checkAPI:function(e,t,n){var r={};for(var a in e)if(r[a]=e[a],t.hasOwnProperty(a))if("object"==typeof r[a])if(Array.isArray(r[a])&&Array.isArray(t[a])){r[a]=[];for(var o=t[a],c=r[a],s=0;s<t[a].length;s++){var u=o[s];c.push(u)}}else"string"==typeof t[a]&&Array.isArray(r[a])?r[a].push(t[a]):r[a]=t[a];else r[a]=t[a];return l.each(n,function(e,r){null!=t[e]&&(n[e]=t[e])}),{local:r,API:n}},terminate:{_root:function(){return f},chk:function(){for(var e=this._root(),r=l.wwmanager,t=r.pool.length,n=r.queue.length,a=0;a<t;a++){for(var o=r.pool[a],c=0,s=0;s<n;s++){var u=r.queue[s];try{if(null!=o&&o.w_type==u.wk_type){c=1;break}}catch(e){console.log("[terminate.chk] error checking workers vs queue ",e,o,u)}}if(null!=o&&o.available&&0==o.persist&&0==c&&(r.pool.splice(a,1),o.terminate(),o=null),0<c){e.chk_queue();break}}if(0==r.queue.length&&0==r.pool.length){var i=this.watch;clearInterval(i),i=!1}},watch:!1,start:function(){0==this.watch&&(this.watch=setInterval(function(){f.terminate.chk()},50))}},get_cmd:function(e){return!("object"!=typeof e||!e.hasOwnProperty("cmd"))&&e.cmd},chk_cmds:function(e){for(var r=!1,t=f.cmds,n=0;n<t;n++)if(f.cmds[n]==e){r=!0;break}return r},proc_fn:function(r){try{for(var e=l.wwmanager,t=r.currentTarget,n=e.queue.length,a=0;a<n;a++){var o=e.queue[a];if(o.uid==t.uid){var c=r.data,s=!0;(s=!f.chk_cmds(f.get_cmd(c)))||c.hasOwnProperty("data")&&(c=c.data),t.success?o.fn.success(c,r):o.fn.failure(c,r),s&&e.queue.splice(a,1);break}}}catch(e){console.log("[wwmanager.methods.proc_fn] error ",e),console.log("[wwmanager.methods.proc_fn] last attempted to process ",r)}},spin_up:function(e,r,t){var n=l.wwmanager;if(t){t.active=!1,t.wk_type=r;var a=function(e,r){0==r.currentTarget.nomsg&&console.log("[wwmanager.success] resp",e)},o=function(e,r){0==r.currentTarget.nomsg&&console.log("[wwmanager.failure] resp",e)};t.hasOwnProperty("fn")?(t.fn.success||(t.fn.success=a),t.fn.failure||(t.fn.failure=o)):t.fn={success:a,failure:o},t.uid=f.newID(),n.queue.push(t)}e&&n.wk_pool.push({fnc:e,type:r}),f.chk_make_thread(),f.chk_queue(),f.terminate.start()},chk_make_thread:function(){var e=l.wwmanager,r=function(e){var r=e.currentTarget.w_key;"message"==e.type&&(e.currentTarget.success=!0),"error"==e.type&&(e.currentTarget.success=!1,console.log("[wwmanager.methods.worker "+r+"] error ... ",e.message),console.log("[wwmanager.methods.worker "+r+"] details ... ",e));var t=!f.chk_cmds(f.get_cmd(e.data));f.proc_fn(e),t&&(e.currentTarget.available=!0,f.spin_up())};if(e.pool.length<e.pmax)for(var t=e.pool.length-1<0?0:e.pool.length-1;t<e.pmax;t++)if(0<e.wk_pool.length){var n=e.wk_pool[e.wk_pool.length-1],a=f.create_worker(n.fnc);e.wk_pool.pop(),a.w_key=t,a.w_type=n.type,a.available=!0,a.onmessage=r,a.onerror=r,e.pool.push(a)}},chk_queue:function(){for(var e=l.wwmanager,r=!1,t=e.queue.length,n=0;n<t;n++){0==(o=e.queue[n]).active&&(r=!0)}if(r){var a=!0;for(n=0;n<t;n++){var o;if(0==(o=e.queue[n]).active){var c={};for(var s in o)"function"!=typeof o[s]&&"fn"!=s&&(c[s]=o[s]);for(var u=0;u<e.pmax;u++){var i=e.pool[u];if(i.available&&i.w_type==o.wk_type){i.persist=!1,c.hasOwnProperty("persist")&&(i.persist=c.persist),i.nomsg=!1,c.hasOwnProperty("nomsg")&&(i.nomsg=c.nomsg),i.postMessage(c),i.uid=c.uid,i.available=!1,a=!(o.active=!0);break}}}}a&&setTimeout(function(){f.spin_up()},10)}},create_worker:function(e){var r=new Blob(["onmessage = (",e.toString(),")"],{type:"text/worker"}),t=URL.createObjectURL(r);return new Worker(t)}}});
