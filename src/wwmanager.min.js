!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(l){l.wwmanager={pool:[],wk_pool:[],pmax:navigator.hardwareConcurrency||10,queue:[]},l.extend(l.fn,{wwmanager:function(){var e=arguments[0],r=[].slice.call(arguments).slice(1);if(a[e])return a[e].apply(this,r);if(e){var t=p.checkAPI(l.wwmanager,e,a);l.wwmanager=t.local,a=t.API}p.startup(e,r[0],r[1])}});var a={debug:function(){console.log(l.wwmanager)},spin_up:function(e,r,t){p.spin_up(e,r,t)}},p={cmds:["wait","stop"],startup:function(e,r,t){p.spin_up(e,r,t)},id_counter:0,newID:function(){var e=new Date;return e=e.getTime()+Math.floor(2e3*Math.random()),p.id_counter++,""+(e+p.id_counter)},checkAPI:function(e,t,a){var r={};for(var n in e)if(r[n]=e[n],t.hasOwnProperty(n))if("object"==typeof r[n])if(Array.isArray(r[n])&&Array.isArray(t[n])){r[n]=[];for(var o=t[n],c=r[n],s=0;s<t[n].length;s++){var u=o[s];c.push(u)}}else"string"==typeof t[n]&&Array.isArray(r[n])?r[n].push(t[n]):r[n]=t[n];else r[n]=t[n];return l.each(a,function(e,r){null!=t[e]&&(a[e]=t[e])}),{local:r,API:a}},terminate:{_root:function(){return p},chk:function(){for(var e=this._root(),r=l.wwmanager,t=r.pool.length,a=r.queue.length,n=0;n<t;n++){for(var o=r.pool[n],c=0,s=0;s<a;s++){var u=r.queue[s];try{if(null!=o&&o.w_type==u.wk_type){c=1;break}}catch(e){console.log("[terminate.chk] error checking workers vs queue ",e,o,u)}}if(null!=o&&o.available&&0==o.persist&&0==c&&(r.pool.splice(n,1),o.terminate(),o=null),0<c){e.chk_queue();break}}if(0==r.queue.length&&0==r.pool.length){var i=this.watch;clearInterval(i),i=!1}},watch:!1,start:function(){0==this.watch&&(this.watch=setInterval(function(){p.terminate.chk()},50))}},get_cmd:function(e){return!("object"!=typeof e||!e.hasOwnProperty("cmd"))&&e.cmd},chk_cmds:function(e,r){for(var t=!1,a=p.cmds,n=0;n<a;n++)if(e==r&&p.cmds[n]==e){t=!0;break}return t},proc_fn:function(r,e){try{for(var t=l.wwmanager,a=r.currentTarget,n=t.queue.length,o=0;o<n;o++){var c=t.queue[o];if(c.uid==a.uid){var s=r.data,u=!e;u||s.hasOwnProperty("data")&&(s=s.data),a.success?c.fn.success(s,r):c.fn.failure(s,r),u&&t.queue.splice(o,1);break}}}catch(e){console.log("[wwmanager.methods.proc_fn] error ",e),console.log("[wwmanager.methods.proc_fn] last attempted to process ",r)}},spin_up:function(e,r,t){var a=l.wwmanager;if(t){t.active=!1,t.wk_type=r;var n=function(e,r){0==r.currentTarget.nomsg&&console.log("[wwmanager.success] resp",e)},o=function(e,r){0==r.currentTarget.nomsg&&console.log("[wwmanager.failure] resp",e)};t.hasOwnProperty("fn")?(t.fn.success||(t.fn.success=n),t.fn.failure||(t.fn.failure=o)):t.fn={success:n,failure:o},t.uid=p.newID(),a.queue.push(t)}e&&a.wk_pool.push({fnc:e,type:r}),p.chk_make_thread(),p.chk_queue(),p.terminate.start()},chk_make_thread:function(){var e=l.wwmanager,r=function(e){var r=e.currentTarget.w_key;"message"==e.type&&(e.currentTarget.success=!0),"error"==e.type&&(e.currentTarget.success=!1,console.log("[wwmanager.methods.worker "+r+"] error ... ",e.message),console.log("[wwmanager.methods.worker "+r+"] details ... ",e));var t=!p.chk_cmds(p.get_cmd(e.data),"wait"),a=!!p.chk_cmds(p.get_cmd(e.data),"stop");0==a&&p.proc_fn(e,t),(0==t||a)&&(e.currentTarget.available=!0,p.spin_up())};if(e.pool.length<e.pmax)for(var t=e.pool.length-1<0?0:e.pool.length-1;t<e.pmax;t++)if(0<e.wk_pool.length){var a=e.wk_pool[e.wk_pool.length-1],n=p.create_worker(a.fnc);e.wk_pool.pop(),n.w_key=t,n.w_type=a.type,n.available=!0,n.onmessage=r,n.onerror=r,e.pool.push(n)}},chk_queue:function(){for(var e=l.wwmanager,r=!1,t=e.queue.length,a=0;a<t;a++){0==(o=e.queue[a]).active&&(r=!0)}if(r){var n=!0;for(a=0;a<t;a++){var o;if(0==(o=e.queue[a]).active){var c={};for(var s in o)"function"!=typeof o[s]&&"fn"!=s&&(c[s]=o[s]);for(var u=0;u<e.pmax;u++){var i=e.pool[u];if(i.available&&i.w_type==o.wk_type){i.persist=!1,c.hasOwnProperty("persist")&&(i.persist=c.persist),i.nomsg=!1,c.hasOwnProperty("nomsg")&&(i.nomsg=c.nomsg),i.postMessage(c),i.uid=c.uid,i.available=!1,n=!(o.active=!0);break}}}}n&&setTimeout(function(){p.spin_up()},10)}},create_worker:function(e){var r=new Blob(["onmessage = (",e.toString(),")"],{type:"text/worker"}),t=URL.createObjectURL(r);return new Worker(t)}}});